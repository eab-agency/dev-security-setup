---
phase: 04-homebrew-tap
type: execute
---

<objective>
Create the `eab-agency/homebrew-tools` tap repository with a formula that installs `setup-security` with `pre-commit` and `trufflehog` as dependencies.

Purpose: This is the core deliverable — the Homebrew formula that makes `brew install eab-agency/tools/dev-security-setup` work. Without this, there's no Homebrew distribution.
Output: A public GitHub repository `eab-agency/homebrew-tools` with `Formula/dev-security-setup.rb` that installs the script and its dependencies.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (all affect this phase):
@.planning/phases/01-script-preparation/01-01-SUMMARY.md
@.planning/phases/02-version-check/02-01-SUMMARY.md
@.planning/phases/03-release-infrastructure/03-01-SUMMARY.md

# Research findings:
@.planning/phases/04-homebrew-tap/04-RESEARCH.md

**Tech stack available:** softprops/action-gh-release@v2, GitHub Actions
**Established patterns:** CLI flag convention (--long-form|-short), tag-triggered releases
**Constraining decisions:**
- Phase 1: v3.0.0 major bump, --version flag exists (enables formula test block)
- Phase 3: Release workflow creates GitHub Releases on v* tag push
- Phase 3: Tarball URL: `https://github.com/eab-agency/dev-security-setup/archive/refs/tags/vX.Y.Z.tar.gz`
- Phase 3: Manual SHA256 update (auto-bump deferred)

**From research — critical rules:**
- Repo MUST be named `homebrew-tools` (Homebrew auto-prepends `homebrew-` when resolving `eab-agency/tools`)
- Formula filename: `dev-security-setup.rb` → class `DevSecuritySetup` (strict CamelCase)
- `bin.install "setup-security.sh" => "setup-security"` — auto-chmod, renames to drop .sh
- `depends_on "pre-commit"` and `depends_on "trufflehog"` — both confirmed in homebrew-core
- No LICENSE in source repo — use `license :cannot_represent` in formula
- SHA256 must be computed AFTER a release exists — use placeholder for now, update after first release

**From research — don't hand-roll:**
- Script installation: use `bin.install`, NOT custom cp+chmod
- Dependencies: use `depends_on`, NOT install instructions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create eab-agency/homebrew-tools repository with formula</name>
  <files>Formula/dev-security-setup.rb, README.md (in the new repo)</files>
  <action>
  Use `gh` CLI to create the tap repository and populate it with the formula:

  1. Create a temporary directory to set up the repo
  2. `gh repo create eab-agency/homebrew-tools --public --description "Homebrew formulae for EAB Agency developer tools" --clone`
  3. Create `Formula/` directory
  4. Create `Formula/dev-security-setup.rb` with this formula:

  ```ruby
  class DevSecuritySetup < Formula
    desc "One-command secret detection pipeline for Git projects"
    homepage "https://github.com/eab-agency/dev-security-setup"
    url "https://github.com/eab-agency/dev-security-setup/archive/refs/tags/v3.0.0.tar.gz"
    sha256 "PLACEHOLDER_UNTIL_FIRST_RELEASE"
    license :cannot_represent

    depends_on "pre-commit"
    depends_on "trufflehog"

    def install
      bin.install "setup-security.sh" => "setup-security"
    end

    test do
      system bin/"setup-security", "--version"
    end
  end
  ```

  5. Create a minimal `README.md`:
  ```
  # EAB Agency Homebrew Tools

  Homebrew formulae for EAB Agency developer tools.

  ## Installation

  brew install eab-agency/tools/dev-security-setup

  ## Formulae

  | Formula | Description |
  |---------|-------------|
  | dev-security-setup | One-command secret detection pipeline for Git projects |
  ```

  6. Git add, commit, and push to main

  **SHA256 note:** The SHA256 is a placeholder because no v3.0.0 release exists yet. It will be updated after the first release is created (Phase 3's workflow handles release creation, then we compute the real SHA256 and update the formula).

  **Critical:** Use `--public` for the repo — Homebrew taps must be publicly accessible for `brew tap` to work.
  </action>
  <verify>
  1. `gh repo view eab-agency/homebrew-tools` succeeds
  2. The repo contains `Formula/dev-security-setup.rb`
  3. The formula has `depends_on "pre-commit"` and `depends_on "trufflehog"`
  4. The formula class is `DevSecuritySetup` (matches filename CamelCase)
  </verify>
  <done>eab-agency/homebrew-tools exists on GitHub with Formula/dev-security-setup.rb containing correct metadata, dependencies, install method, and test block</done>
</task>

<task type="auto">
  <name>Task 2: Tap the repo and validate formula syntax</name>
  <files>None (local brew operations only)</files>
  <action>
  Validate the formula works with Homebrew locally:

  1. `brew tap eab-agency/tools` — should succeed (clones the repo)
  2. `brew audit eab-agency/tools/dev-security-setup` — check for formula style issues (some warnings expected due to placeholder SHA256)
  3. Verify the formula is visible: `brew info eab-agency/tools/dev-security-setup` — should show formula metadata

  **Do NOT run `brew install` yet** — the SHA256 is a placeholder so installation will fail. That's expected and correct. The formula will become installable after the first `v3.0.0` release is created and the SHA256 is updated.

  If audit returns fixable warnings (not related to SHA256), fix them by updating the formula in the tap repo and pushing.
  </action>
  <verify>
  1. `brew tap` output includes `eab-agency/tools`
  2. `brew info eab-agency/tools/dev-security-setup` shows formula metadata (name, desc, homepage, deps)
  3. No critical errors from `brew audit` (SHA256 warnings are expected and acceptable)
  </verify>
  <done>Tap is registered locally, formula is recognized by Homebrew, audit passes with no critical errors (SHA256 placeholder warning acceptable)</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `eab-agency/homebrew-tools` exists as a public GitHub repository
- [ ] `Formula/dev-security-setup.rb` exists with correct class name, metadata, dependencies, install, and test
- [ ] `brew tap eab-agency/tools` succeeds
- [ ] `brew info eab-agency/tools/dev-security-setup` shows correct metadata
- [ ] Formula declares `pre-commit` and `trufflehog` as dependencies
- [ ] Formula uses `bin.install "setup-security.sh" => "setup-security"` for installation
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Tap repo is public and accessible
- Formula is syntactically valid and recognized by Homebrew
- Dependencies correctly declared
- SHA256 is placeholder (will be updated after first release)
- Phase 4 complete (consolidated from 2 roadmap plans — testing is part of creation)
</success_criteria>

<output>
After completion, create `.planning/phases/04-homebrew-tap/04-01-SUMMARY.md`
</output>
