---
phase: 01-script-preparation
type: execute
---

<objective>
Adapt setup-security.sh for Homebrew distribution — ensure the script works as a standalone binary installed to PATH via `bin.install "setup-security.sh" => "setup-security"`.

Purpose: The script must be fully self-contained with no assumptions about being run from a cloned repo directory. After analysis, the script already uses relative-to-$PWD paths correctly — the cloned-repo pattern (git pull, ~/dev-security-setup/) only exists in the README's shell function wrapper. The main work is verifying standalone behavior, adding a `--version` flag for Homebrew convention, and ensuring `detect-secrets` is listed as a checked dependency (currently missing from `check_dependency` calls despite being used).

Output: A script that can be installed to any PATH location and run from any git project root.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@setup-security.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add --version flag and verify detect-secrets dependency check</name>
  <files>setup-security.sh</files>
  <action>
  1. Add a `--version` flag to the argument parser that prints the version and exits. This is standard for CLI tools and required for Homebrew formula test blocks (`assert_match "version", shell_output("setup-security --version")`). Add it alongside the existing `--help` case:
     ```
     --version|-v)
         echo "setup-security version $VERSION"
         exit 0
         ;;
     ```
  2. Add `detect-secrets` to the dependency checks (line ~102-103). The script calls `detect-secrets scan` on line 436 but never verifies it's installed. Add:
     ```
     check_dependency "detect-secrets" "pip install detect-secrets"
     ```
  3. Update the `--help` output to include the `--version` flag in the options list.

  Do NOT change any other behavior, paths, or logic. The script's existing relative-path approach is correct for Homebrew.
  </action>
  <verify>
  Run: `bash setup-security.sh --version` — should print "setup-security version 2.2.0"
  Run: `bash setup-security.sh --help` — should list --version in options
  </verify>
  <done>--version flag works, --help shows all flags including --version, detect-secrets is checked as a dependency</done>
</task>

<task type="auto">
  <name>Task 2: Bump version to 3.0.0 for Homebrew release</name>
  <files>setup-security.sh</files>
  <action>
  Bump VERSION from "2.2.0" to "3.0.0" on line 5. This is a major version bump because:
  - Distribution model changes fundamentally (clone → Homebrew)
  - The auto-update mechanism (git pull in shell function) is being replaced by brew upgrade + version-check alerting (Phase 2)
  - Users will migrate from the shell function to the Homebrew-installed binary

  This is a clean break point — v3.0.0 = first Homebrew-distributed version.

  Do NOT change anything else. The version bump ensures existing per-project `.security/version` files (tracking v2.2.0) will trigger the upgrade path when users run the new Homebrew-installed version.
  </action>
  <verify>
  Run: `bash setup-security.sh --version` — should print "setup-security version 3.0.0"
  Run: `grep '^VERSION=' setup-security.sh` — should show VERSION="3.0.0"
  </verify>
  <done>VERSION is "3.0.0", --version output reflects the new version</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `bash setup-security.sh --version` prints version string
- [ ] `bash setup-security.sh --help` lists all flags including --version
- [ ] `grep 'detect-secrets' setup-security.sh` shows both the dependency check and the scan usage
- [ ] Script still has `set -e` and proper error handling
- [ ] No hardcoded paths to `~/dev-security-setup/` or any absolute paths
- [ ] All existing flags (--force, --with-commitlint, --with-linting, --help) still work
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Script is fully standalone (no cloned-repo assumptions)
- --version flag works for Homebrew formula testing
- detect-secrets dependency is properly checked
- Version bumped to 3.0.0 for Homebrew release
</success_criteria>

<output>
After completion, create `.planning/phases/01-script-preparation/01-01-SUMMARY.md`
</output>
