---
phase: 03-release-infrastructure
type: execute
---

<objective>
Create a GitHub Actions workflow that automatically creates GitHub Releases when version tags are pushed, establishing the release infrastructure that Homebrew formula will reference.

Purpose: The Homebrew formula (Phase 4) needs a stable tarball URL and SHA256 hash. GitHub auto-generates tarballs for all tags, and the release workflow provides the trigger mechanism and release notes. This is the bridge between "script updated" and "users can brew upgrade."
Output: `.github/workflows/release.yml` that triggers on `v*` tag push and creates a GitHub Release with auto-generated notes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (both affect this phase):
@.planning/phases/01-script-preparation/01-01-SUMMARY.md
@.planning/phases/02-version-check/02-01-SUMMARY.md

# Research findings:
@.planning/phases/03-release-infrastructure/03-RESEARCH.md

**Tech stack available:** GitHub Actions, softprops/action-gh-release@v2
**Established patterns:** CLI flag convention: --long-form|-short
**Constraining decisions:**
- Phase 1: v3.0.0 major bump — first tag will be v3.0.0
- Phase 1: --version flag exists (enables Homebrew formula test blocks)
- Phase 2: check_for_updates() queries GitHub releases API — will start working once releases exist

**From research — DO NOT hand-roll:**
- Release creation: use `softprops/action-gh-release@v2` (not custom API calls or `actions/create-release`)
- Release notes: use `generate_release_notes: true` (not custom changelog scripts)
- Tarball creation: GitHub auto-generates for all tags (no custom tar command)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions release workflow</name>
  <files>.github/workflows/release.yml</files>
  <action>
  Create `.github/workflows/release.yml` with this exact configuration:

  - **Trigger:** `on: push: tags: ["v*"]` — fires on any tag starting with `v`
  - **Permissions:** `permissions: contents: write` — required for creating releases (GitHub Actions defaults to read-only)
  - **Job:** Single job `release` on `ubuntu-latest`
  - **Steps:**
    1. `actions/checkout@v4` — needed so the release has the repo context
    2. `softprops/action-gh-release@v2` with `generate_release_notes: true` — creates the release with auto-generated notes from commits/PRs since last release

  The workflow should be minimal — no custom scripts, no asset uploads, no matrix builds. This is a single bash script project.

  **Critical from research:**
  - MUST include `permissions: contents: write` (Pitfall 2 — without it, release creation fails with 403)
  - Use `softprops/action-gh-release@v2` NOT `actions/create-release` (research: better maintained, simpler)
  - `generate_release_notes: true` auto-generates notes from PRs and commits — no custom changelog needed
  </action>
  <verify>
  1. `cat .github/workflows/release.yml` shows valid YAML
  2. `grep 'softprops/action-gh-release' .github/workflows/release.yml` confirms the action
  3. `grep 'permissions' .github/workflows/release.yml` confirms write permission
  4. `grep 'v\*' .github/workflows/release.yml` confirms tag trigger pattern
  </verify>
  <done>release.yml exists with tag trigger, write permissions, checkout, and softprops/action-gh-release with auto-generated notes</done>
</task>

<task type="auto">
  <name>Task 2: Document the release process</name>
  <files>setup-security.sh</files>
  <action>
  Add a comment block at the top of `setup-security.sh` (after the VERSION line, before SECURITY_DIR) documenting the release process for future maintainers:

  ```
  # Release process:
  #   1. Update VERSION above to match the new version
  #   2. Commit: git commit -am "chore: bump version to X.Y.Z"
  #   3. Tag: git tag vX.Y.Z
  #   4. Push: git push origin main --tags
  #   5. GitHub Actions creates the release automatically
  #   6. Update Homebrew formula SHA256: curl -sL https://github.com/eab-agency/dev-security-setup/archive/refs/tags/vX.Y.Z.tar.gz | shasum -a 256
  ```

  This is important because:
  - The VERSION variable in the script must match the git tag (Phase 2's version check compares these)
  - The SHA256 must be computed AFTER the release is published (research Pitfall 4)
  - The formula in the tap repo must be updated with the new SHA256 (Phase 4 concern)

  Keep it to 6 concise lines. Do NOT add verbose documentation — this is a quick reference for the release workflow.
  </action>
  <verify>
  1. `grep 'Release process' setup-security.sh` confirms the comment exists
  2. `grep 'shasum -a 256' setup-security.sh` confirms SHA256 instructions
  3. `bash -n setup-security.sh` syntax check still passes
  4. `bash setup-security.sh --version` still works
  </verify>
  <done>Release process documented as a comment block in setup-security.sh with VERSION bump, tag, push, and SHA256 computation steps</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `.github/workflows/release.yml` exists and is valid YAML
- [ ] Workflow triggers on `v*` tag push
- [ ] Workflow has `permissions: contents: write`
- [ ] Workflow uses `softprops/action-gh-release@v2` with `generate_release_notes: true`
- [ ] Release process is documented in setup-security.sh
- [ ] `bash -n setup-security.sh` passes (no syntax errors introduced)
- [ ] `bash setup-security.sh --version` still prints version
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Release workflow is ready to fire on next `v*` tag push
- Release process is documented for future maintainers
- No hand-rolled solutions (uses standard actions per research)
- Phase 3 complete (covers both 03-01 and 03-02 from roadmap — SHA256 is documented as part of the release process, not a separate workflow)
</success_criteria>

<output>
After completion, create `.planning/phases/03-release-infrastructure/03-01-SUMMARY.md`
</output>
